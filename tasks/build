#!./virt_env/bin/python
#
import sys
import os
import shutil
import rwt
from rwt.pagination import Pagination

def log(msg):
    sys.stdout.write(">> " + msg + "\n")

# site/css
# site/images/portraits
shutil.copytree("public", "site")

# site/404.html
log("Creating 404.")
data = {}
data['title'] = '404'
data['type'] = 'post'
data['content'] = open('pages/404.html').read()
rwt.render('site/404.html', data=data, title='404')

# site/about.html
log("Creating about.")
data = {}
data['title'] = 'About'
data['type'] = 'post'
data['content'] = open('pages/about/index.html').read()
rwt.render('site/about.html', data=data, title='about')

# Load all posts (name, summary, tags, content (markdown))
# yaml + markdown
posts = rwt.load_posts()
posts.reverse()
log("Loaded %s interviews." % len(posts))

# site/interviews/NAME/index.html (individual interviews)
log("Rendering interviews.")
for p in posts:
    log("interview: %s" % p.name)
    out_file = 'site/interviews/%s/index.html' % p.dot_name
    rwt.render(out_file, 'interview.html', post=p, title=p.name)

# Pages (list of interviews + pagination)
log("Creating interviews' pages")
pnation = Pagination(posts, 3)
for page in pnation.iter_pages():
    out_file = 'site/page%s/index.html' % page["curr"]
    rwt.render(out_file, 'interviews.html', page=page, title="page #%s" % page["curr"], pagination=pnation)
shutil.copyfile("site/page0/index.html", "site/index.html")


# TODO
# - default template
#    - last update time
#    - # interviews, # categories , # of bits
#    - licence CSS
#    - expand bits in markkown
# - interview template
# DONE - fix posted time
# DONE - landing page + pagination

